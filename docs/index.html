<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Trading 212 Exit Tax</title>
  <link rel="stylesheet" href="./styles.css?v=20260202" />
</head>
<body>
  <!-- Top bar (always visible) -->
  <div class="topbar">
    <div class="brand">
      <div class="logo">T</div>
      <div style="min-width:0;">
        <div class="brand-title">Trading 212 Exit Tax</div>
        <div class="brand-subtitle">Estimate Irish exit tax (deemed disposal) on your Trading 212 ETF holdings — includes next deemed disposal dates.</div>
      </div>
    </div>

    <div class="row row-right">
      <button id="btnReload" class="btn btn-ghost" type="button">Reload</button>
    </div>
  </div>

  <!-- CONNECT VIEW -->
  <div id="viewConnect">
    <div class="layout layout-single" style="padding-top: 22px;">
      <aside class="drawer" style="max-width: 860px; margin: 0 auto;">
        <div class="drawer-header">
          <div>
            <div class="drawer-title">Connect</div>
            <div class="drawer-subtitle">Keys are stored locally in your browser (localStorage) if you tick “Remember this device”. No server.</div>
          </div>
          <button id="btnClearKeys" class="btn btn-ghost" type="button" onclick="document.getElementById('apiKey').value=''; document.getElementById('apiSecret').value='';">Clear</button>
        </div>

        <div class="drawer-body" style="padding-top: 10px;">
          <div id="connectBanner" class="banner banner-warn hidden" aria-live="polite"></div>

          <div class="form form-wide">
            <div class="field">
              <label for="apiKey">API key</label>
              <input id="apiKey" type="text" placeholder="t212_..." autocomplete="off" />
            </div>

            <div class="field">
              <label for="apiSecret">API secret</label>
              <input id="apiSecret" type="password" placeholder="••••••••" autocomplete="off" />
            </div>

            <div class="field">
              <label>Environment</label>

              <div class="seg seg-env" role="group" aria-label="Trading 212 environment">
                <label class="seg-item" for="env_live">
                  <input type="radio" id="env_live" name="apiEnv" value="live" checked />
                  <span>Live (real account)</span>
                </label>

                <label class="seg-item" for="env_demo">
                  <input type="radio" id="env_demo" name="apiEnv" value="demo" />
                  <span>Demo (practice account)</span>
                </label>
              </div>

              <div class="small" style="margin-top: 6px;">If your keys are for a demo account, choose Demo. Live keys won’t work on Demo and vice‑versa.</div>
            </div>

            <label class="checkbox" for="rememberDevice">
              <input id="rememberDevice" type="checkbox" />
              Remember this device
            </label>

            <div class="row row-right">
              <button id="btnFetchHoldings" class="btn btn-accent" type="button">Fetch holdings</button>
            </div>

          </div>
        </div>
      </aside>
    </div>

    <div class="footer">
      <div class="disclaimer">Prototype UI. Not tax advice. Exit tax rules can be complex; confirm with Revenue guidance or a professional adviser.</div>
      <div class="disclaimer"><strong>Distributions / dividends note (Ireland):</strong> If your holding is an Irish-domiciled investment fund (or an equivalent EU/EEA/OECD fund treated under the Irish “exit tax” regime), both income and gains are taxed under the exit tax / investment undertaking rules (rate 38% for individuals). This tool only estimates the exit tax implied by your current open position “if sold today” and does not compute tax already triggered by past cash distributions or other events. Distributions can therefore affect your total taxes even if your current unrealised P/L looks unchanged.</div>
    </div>
  </div>

  <!-- OVERDUE QUESTIONS VIEW -->
  <div id="viewOverdue" class="hidden">
    <div class="layout layout-single" style="padding-top: 22px;">
      <div class="panel" style="max-width: 980px; margin: 0 auto;">
        <div class="panel-header">
          <h1>Deemed disposal questions</h1>
          <div class="summary">Some holdings appear to have passed a deemed disposal date. We need a bit more info to estimate exit tax correctly.</div>
        </div>

        <div class="panel-body">
          <div id="overdueList" class="overdue-list"></div>

          <div class="row row-right" style="margin-top: 14px;">
            <button id="btnOverdueContinue" class="btn btn-accent" type="button">Continue</button>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="disclaimer">Prototype UI. Not tax advice. Exit tax rules can be complex; confirm with Revenue guidance or a professional adviser.</div>
      <div class="disclaimer"><strong>Distributions / dividends note (Ireland):</strong> If your holding is an Irish-domiciled investment fund (or an equivalent EU/EEA/OECD fund treated under the Irish “exit tax” regime), both income and gains are taxed under the exit tax / investment undertaking rules (rate 38% for individuals). This tool only estimates the exit tax implied by your current open position “if sold today” and does not compute tax already triggered by past cash distributions or other events. Distributions can therefore affect your total taxes even if your current unrealised P/L looks unchanged.</div>
    </div>
  </div>

  <!-- DASHBOARD VIEW -->
  <div id="viewDashboard" class="hidden">
    <div class="layout" style="padding-top: 12px;">
      <div class="panel">
        <div class="panel-header">
          <h1>Holdings</h1>
          <div id="summary" class="summary">—</div>
        </div>

        <div class="panel-body">
          <div id="overdueBanner" class="banner banner-danger hidden" aria-live="polite"></div>

          <div class="panel-title" style="margin: 6px 0 10px;">Likely subject to deemed disposal</div>

          <div class="table-wrap">
            <table class="table" aria-label="Likely subject to deemed disposal">
              <thead>
                <tr>
                  <th>Security</th>
                  <th>ISIN</th>
                  <th class="num">Value</th>
                  <th class="num">Unrealised P/L</th>
                  <th>Next deemed disposal</th>
                  <th class="num">Exit tax (if today)</th>
                  <th class="num">Action</th>
                </tr>
              </thead>
              <tbody id="holdingsTbody"></tbody>
            </table>
          </div>

          <div class="panel-title" style="margin: 16px 0 10px;">Other securities</div>

          <div class="table-wrap">
            <table class="table" aria-label="Other securities">
              <thead>
                <tr>
                  <th>Security</th>
                  <th>ISIN</th>
                  <th class="num">Value</th>
                  <th class="num">Unrealised P/L</th>
                  <th>Next deemed disposal</th>
                  <th class="num">Action</th>
                </tr>
              </thead>
              <tbody id="otherTbody"></tbody>
            </table>
            <div id="otherEmpty" class="empty hidden">No other securities.</div>
          </div>
        </div>

      </div>

      <aside class="drawer">
        <div class="drawer-header">
          <div>
            <div class="drawer-title">Details</div>
            <div id="assumptionsSubtitle" class="drawer-subtitle">Select a security to view details</div>
          </div>
          <div class="row" style="gap: 10px;">
            <button id="btnClose" class="btn btn-ghost" type="button">Clear selection</button>
          </div>
        </div>

        <div id="drawerBody" class="drawer-body">
          <div class="empty">Select a security to see how dates and tax are calculated.</div>
        </div>
      </aside>
    </div>

    <!-- PARTIAL WITHDRAWAL CALCULATOR (below Holdings + Details) -->
    <div id="partialWithdrawalCard" class="panel hidden" style="max-width: 1200px; margin: 12px auto 0;">
      <div class="panel-header">
        <h1 style="margin:0;">Partial withdrawal calculator</h1>
        <div id="partialWithdrawalSubtitle" class="summary">Select an exit-tax holding to estimate exit tax on a partial withdrawal.</div>
      </div>

      <div class="panel-body">
        <div id="partialWithdrawalMsg" class="banner banner-warn hidden" aria-live="polite"></div>

        <div class="form form-wide" style="max-width: 640px;">
          <div class="field">
            <label for="withdrawAmount">Withdrawal amount</label>
            <input id="withdrawAmount" type="number" inputmode="decimal" min="0" step="0.01" placeholder="0.00" autocomplete="off" />
            <div class="small" id="withdrawMax" style="margin-top: 6px;">—</div>
          </div>
        </div>

        <div class="kv" style="margin-top: 10px;">
          <div class="card">
            <div class="label">Estimated exit tax</div>
            <div class="value" id="withdrawTax">—</div>
          </div>
          <div class="card">
            <div class="label">Gain portion</div>
            <div class="value" id="withdrawGain">—</div>
          </div>
          <div class="card">
            <div class="label">Principal portion</div>
            <div class="value" id="withdrawPrincipal">—</div>
          </div>
        </div>

        <div class="small" style="margin-top: 10px;">
          Estimate uses today’s price and average cost, and ignores any broker fees/spread.
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="disclaimer">Prototype UI. Not tax advice. Exit tax rules can be complex; confirm with Revenue guidance or a professional adviser.</div>
      <div class="disclaimer"><strong>Distributions / dividends note (Ireland):</strong> If your holding is an Irish-domiciled investment fund (or an equivalent EU/EEA/OECD fund treated under the Irish “exit tax” regime), both income and gains are taxed under the exit tax / investment undertaking rules (rate 38% for individuals). This tool only estimates the exit tax implied by your current open position “if sold today” and does not compute tax already triggered by past cash distributions or other events. Distributions can therefore affect your total taxes even if your current unrealised P/L looks unchanged.</div>
    </div>
  </div>

  <!-- Load app logic (single source of truth) -->
  <script type="module" src="./app.js?v=20260202"></script>
</body>
</html>
